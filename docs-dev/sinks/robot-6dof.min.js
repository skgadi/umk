function init(){container=document.createElement("div"),document.body.appendChild(container),camera=new THREE.PerspectiveCamera(45,window.innerWidth/window.innerHeight,1,2e3),camera.position.set(2,2,3),scene=new THREE.Scene;var e=new THREE.GridHelper(20,20);scene.add(e),scene.add(dae),particleLight=new THREE.Mesh(new THREE.SphereBufferGeometry(4,8,8),new THREE.MeshBasicMaterial({color:16777215})),scene.add(particleLight);var t=new THREE.HemisphereLight(16772846,1118498);scene.add(t);var i=new THREE.PointLight(16777215,.3);particleLight.add(i),particleLight.position.x=3e3,particleLight.position.y=3e3,particleLight.position.z=3e3,renderer=new THREE.WebGLRenderer,renderer.setPixelRatio(window.devicePixelRatio),renderer.setSize(window.innerWidth,window.innerHeight),container.appendChild(renderer.domElement),heartBeat();var a=new OrbitControls(camera,renderer.domElement);a.minDistance=0,a.maxDistance=1e3,a.target.set(-0,5,-0),a.update(),camera.position.x=20,camera.position.y=20,camera.position.z=20,camera.lookAt(0,5,0),window.addEventListener("resize",onWindowResize,!1)}function moveRobot(){var e=state.duration,t={};for(var i in kinematics.joints)if(kinematics.joints.hasOwnProperty(i)&&!kinematics.joints[i].static){var a=kinematics.joints[i],n=tweenParameters[i],s=n||a.zeroPosition;tweenParameters[i]=s,state.pos[i]<a.limits.min?t[i]=a.limits.min:state.pos[i]>a.limits.max?t[i]=a.limits.min:state.pos[i]||0===state.pos[i]?t[i]=state.pos[i]:t[i]=a.zeroPosition}kinematicsTween=new TWEEN.Tween(tweenParameters).to(t,e).easing(TWEEN.Easing.Quadratic.Out),kinematicsTween.onUpdate(function(e){for(var t in kinematics.joints)kinematics.joints.hasOwnProperty(t)&&(kinematics.joints[t].static||kinematics.setJointValue(t,e[t]))}),kinematicsTween.start()}function setupTween(){var e=THREE.MathUtils.randInt(1e3,5e3),t={};for(var i in kinematics.joints)if(kinematics.joints.hasOwnProperty(i)&&!kinematics.joints[i].static){var a=kinematics.joints[i],n=tweenParameters[i],s=n||a.zeroPosition;tweenParameters[i]=s,t[i]=THREE.MathUtils.randInt(a.limits.min,a.limits.max)}kinematicsTween=new TWEEN.Tween(tweenParameters).to(t,e).easing(TWEEN.Easing.Quadratic.Out),kinematicsTween.onUpdate(function(e){for(var t in kinematics.joints)kinematics.joints.hasOwnProperty(t)&&(kinematics.joints[t].static||kinematics.setJointValue(t,e[t]))}),kinematicsTween.start(),setTimeout(setupTween,e)}function onWindowResize(){camera.aspect=window.innerWidth/window.innerHeight,camera.updateProjectionMatrix(),renderer.setSize(window.innerWidth,window.innerHeight)}function animate(){requestAnimationFrame(animate),render(),TWEEN.update()}function render(){renderer.render(scene,camera)}function updateData(e){allData=allData.concat(e),allData=allData.slice(-settings.limitData),updateLimits()}function restThedata(){allData=[]}function updateLimits(){var e=document.getElementById("ctl-slider");if(allData.length>0?(e.max=allData.length-1,state.t<allData[0].t&&setValue(0)):setValue(0),allData.length>=2){let e=Math.round(1e3*(allData[1].t-allData[0].t));e>=1&&(state.duration=e)}}function setValue(e){const t=allData[e];state.pos.joint_1=t.v[0].r[0][0],state.pos.joint_2=t.v[1].r[0][0],state.pos.joint_3=t.v[2].r[0][0],state.pos.joint_4=t.v[3].r[0][0],state.pos.joint_5=t.v[4].r[0][0],state.pos.joint_6=t.v[5].r[0][0];const i=getXYZPosition();document.getElementById("ctl-slider").value=e,document.getElementById("ctl-info").innerHTML="t="+limitDecimalsTo3(t.t)+"; &theta;<sub>1</sub>="+limitDecimalsTo3(t.v[0].r[0][0])+"; &theta;<sub>2</sub>="+limitDecimalsTo3(t.v[1].r[0][0])+"; &theta;<sub>3</sub>="+limitDecimalsTo3(t.v[2].r[0][0])+"; &theta;<sub>4</sub>="+limitDecimalsTo3(t.v[3].r[0][0])+"; &theta;<sub>5</sub>="+limitDecimalsTo3(t.v[4].r[0][0])+"; &theta;<sub>6</sub>="+limitDecimalsTo3(t.v[5].r[0][0])+"; x<sub>w</sub>="+limitDecimalsTo3(i.x)+"; y<sub>w</sub>="+limitDecimalsTo3(i.y)+"; z<sub>w</sub>="+limitDecimalsTo3(i.z)+";",moveRobot()}function limitDecimalsTo3(e){return Math.round(1e3*e)/1e3}function getXYZPosition(){const e=Math.PI/180,t=state.pos.joint_1*e,i=state.pos.joint_2*e,a=state.pos.joint_3*e,n=t,s=Math.PI/2-i,o=-a-Math.PI/2,l=s+o,r=Math.cos(n),c=Math.sin(n),d=Math.cos(s),m=Math.sin(s),u=Math.cos(l),p=Math.sin(l),y=.4865,h=.15,w=.475,E=.6,g=r*(w*d+E*u)+h*r,f=c*(w*d+E*u)+h*c,b=y+w*m+E*p;return{x:g,y:f,z:b}}function heartBeat(){setTimeout(()=>{state.isRunning&&takeNextStep(),heartBeat()},state.duration)}function takeNextStep(){let e=document.getElementById("ctl-slider").value;state.isForward?(e++,e>=allData.length&&(e=0)):(e--,e<0&&(e=allData.length>0?allData.length-1:0)),e<allData.length?setValue(e):allData.length>0&&setValue(0)}function playButtonOperation(e){state.isRunning=!state.isRunning,state.isForward=e,state.isRunning?(document.getElementById("play").innerHTML='<i class="fas fa-pause fa-fw"></i>',document.getElementById("play-back").innerHTML='<i class="fas fa-pause fa-fw"></i>',e?(document.getElementById("play").style.visibility="visible",document.getElementById("play-back").style.visibility="hidden"):(document.getElementById("play").style.visibility="hidden",document.getElementById("play-back").style.visibility="visible"),document.getElementById("step").style.visibility="hidden",document.getElementById("step-back").style.visibility="hidden"):(document.getElementById("play").innerHTML='<i class="fas fa-play fa-fw"></i>',document.getElementById("play-back").innerHTML='<i class="fas fa-play fa-rotate-180 fa-fw"></i>',document.getElementById("play").style.visibility="visible",document.getElementById("play-back").style.visibility="visible",document.getElementById("step").style.visibility="visible",document.getElementById("step-back").style.visibility="visible")}const settings={limitData:1e3},state={t:0,pos:{joint_1:0,joint_2:0,joint_3:0,joint_4:0,joint_5:0,joint_6:0},duration:10,isRunning:!0,isForward:!0};import*as THREE from"../dependencies/three/build/three.module.js";import{TWEEN}from"../dependencies/three/examples/jsm/libs/tween.module.min.js";import{ColladaLoader}from"../dependencies/three/examples/jsm/loaders/ColladaLoader.js";import{OrbitControls}from"../dependencies/three/examples/jsm/controls/OrbitControls.js";var container,camera,scene,renderer,particleLight,dae,kinematics,kinematicsTween,tweenParameters={},loader=new ColladaLoader;loader.load("../dependencies/three/examples/models/collada/abb_irb52_7_120.dae",function(e){dae=e.scene,dae.traverse(function(e){e.isMesh&&(e.material.flatShading=!0)}),dae.scale.x=dae.scale.y=dae.scale.z=10,dae.updateMatrix(),kinematics=e.kinematics,init(),animate()}),onmessage=function(e){e.data.d&&updateData(e.data.d),e.data.r&&restThedata(),e.data.c&&(settings.limitData=JSON.parse(e.data.c.Parameters.limitData.Value)[0][0],document.title=e.data.c.Name),e.data.s&&(settings.mSettings=e.data.s)};var allData=[];document.getElementById("ctl-slider").onchange=function(){setValue(document.getElementById("ctl-slider").value)},document.getElementById("play").onclick=function(){playButtonOperation(!0)},document.getElementById("play-back").onclick=function(){playButtonOperation(!1)},document.getElementById("step").onclick=function(){state.isForward=!0,takeNextStep()},document.getElementById("step-back").onclick=function(){state.isForward=!1,takeNextStep()};